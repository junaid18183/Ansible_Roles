- name: ensure nova packages are installed
  yum: pkg={{ item }}
  with_items:
    - python-nova
    - python-novaclient
    - openstack-nova-api
    - openstack-nova-cert
    - openstack-nova-compute
    - openstack-nova-conductor
    - openstack-nova-console
    - openstack-nova-novncproxy
    - openstack-nova-scheduler

- name: ensure nova sqlite is deleted
  file: dest=/var/lib/nova/nova.sqlite state=absent
    
# - name: ensure api-paste.ini is present
#   copy: >
#     src=etc/nova/api-paste.ini 
#     dest=/etc/nova/api-paste.ini 
#     owner=nova 
#     group=nova 
#     mode=0660 
#     backup=yes
#   notify: 
#   - restart nova-services

- name: ensure /etc/nova directory is present
  file: path=/etc/nova owner=root group=root mode=0755 state=directory

- name: ensure nova.conf file is present
  template: >
    src=etc/nova/nova.conf
    dest=/etc/nova/nova.conf
    owner=nova
    group=nova
    mode=0660
  notify: 
  - restart nova-services

- name: ensure nova db is initialized
  command: /usr/bin/nova-manage db sync
